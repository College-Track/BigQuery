WITH gather_student_data AS (
  SELECT
    Contact_Id,
    site_short,
    College_Track_Status_Name,
    high_school_graduating_class_c,
    grade_c,
    full_name_c,
    email,
    Most_Recent_GPA_Cumulative_c,
    most_recent_gpa_semester_c,
    total_bank_book_balance_contact_c,
    community_service_hours_c,
    Attendance_Rate_Current_AS_c,
    Current_HS_CT_Coach_c,
    community_service_form_link_c,
    summer_experience_form_link_c,
    current_academic_semester_c
  FROM
    `data-warehouse-289815.salesforce_clean.contact_template`
  WHERE
    college_track_status_c IN ('11A', '18a', '12A')
),
gather_enrollment_data AS (
  SELECT
    student_c,
    workshop_display_name_c,
    start_time_c,
    recurring_days_c,
    Status_c,
    Academic_Semester_c,
    SUM(Attendance_Numerator_c) AS attended_sessions,
    SUM(Attendance_Denominator_c) AS enrolled_sessions,
    SUM(Attendance_Numerator_c) / SUM(Attendance_Denominator_c) AS attendance_rate
  FROM
    `data-warehouse-289815.salesforce_clean.class_template`

  GROUP BY
    student_c,
    workshop_display_name_c,
    start_time_c,
    recurring_days_c,
    Status_c,
    Academic_Semester_c
)
SELECT
  *
FROM
  gather_enrollment_data
  LIMIT 1000