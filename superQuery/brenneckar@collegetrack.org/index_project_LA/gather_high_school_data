WITH gather_data AS (
  SELECT
    C.Contact_Id,
    CAT.npsp_primary_affiliation_c,
    A.Universal_ID_c,
    RIGHT(A.Universal_ID_c, 5) AS mod_universal_id,
    A.name,
    A.billing_city,
    A.billing_state,
    A.billing_street
  FROM
    `learning-agendas.index_project.student_with_census` C
    LEFT JOIN `data-warehouse-289815.salesforce_clean.contact_template` CAT ON c.Contact_Id = CAT.Contact_Id
    LEFT JOIN `data-warehouse-289815.salesforce.account` A ON CAT.npsp_primary_affiliation_c = A.id
)
SELECT
  *,
  CAST(mod_universal_id AS INT64) AS final_universal_id,
  
  CONCAT('https://www.greatschools.org/', billing_state, '/',CAST(mod_universal_id AS INT64)) AS url
FROM
  gather_data
  WHERE name LIKE '%Oakland%'